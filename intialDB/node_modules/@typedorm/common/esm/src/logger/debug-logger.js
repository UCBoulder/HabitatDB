import debug from 'debug';
import chalk from 'chalk';
import { v4 } from 'uuid';
export var TRANSFORM_TYPE;
(function (TRANSFORM_TYPE) {
    TRANSFORM_TYPE["GET"] = "GET";
    TRANSFORM_TYPE["PUT"] = "PUT";
    TRANSFORM_TYPE["UPDATE"] = "UPDATE";
    TRANSFORM_TYPE["DELETE"] = "DELETE";
    TRANSFORM_TYPE["QUERY"] = "QUERY";
    TRANSFORM_TYPE["RESPONSE"] = "RESPONSE";
})(TRANSFORM_TYPE || (TRANSFORM_TYPE = {}));
export var MANAGER_NAME;
(function (MANAGER_NAME) {
    MANAGER_NAME["ENTITY_MANAGER"] = "ENTITY MANAGER";
    MANAGER_NAME["TRANSACTION_MANAGER"] = "TRANSACTION MANAGER";
    MANAGER_NAME["BATCH_MANAGER"] = "BATCH MANAGER";
    MANAGER_NAME["SCAN_MANAGER"] = "SCAN_MANAGER";
})(MANAGER_NAME || (MANAGER_NAME = {}));
export var TRANSFORM_TRANSACTION_TYPE;
(function (TRANSFORM_TRANSACTION_TYPE) {
    TRANSFORM_TRANSACTION_TYPE["TRANSACTION_WRITE"] = "TRANSACTION_WRITE";
    TRANSFORM_TRANSACTION_TYPE["TRANSACTION_READ"] = "TRANSACTION_READ";
})(TRANSFORM_TRANSACTION_TYPE || (TRANSFORM_TRANSACTION_TYPE = {}));
export var TRANSFORM_SCAN_TYPE;
(function (TRANSFORM_SCAN_TYPE) {
    TRANSFORM_SCAN_TYPE["SCAN"] = "SCAN";
    TRANSFORM_SCAN_TYPE["PARALLEL_SCAN"] = "PARALLEL_SCAN";
})(TRANSFORM_SCAN_TYPE || (TRANSFORM_SCAN_TYPE = {}));
export var TRANSFORM_BATCH_TYPE;
(function (TRANSFORM_BATCH_TYPE) {
    TRANSFORM_BATCH_TYPE["BATCH_WRITE"] = "BATCH_WRITE";
    TRANSFORM_BATCH_TYPE["BATCH_READ"] = "BATCH_READ";
})(TRANSFORM_BATCH_TYPE || (TRANSFORM_BATCH_TYPE = {}));
export var STATS_TYPE;
(function (STATS_TYPE) {
    STATS_TYPE["CONSUMED_CAPACITY"] = "CONSUMED_CAPACITY";
})(STATS_TYPE || (STATS_TYPE = {}));
export class DebugLogger {
    // log
    debugTransformLog = debug('typedorm:transform:log');
    // batch transform logger
    debugTransformBatchLog = debug('typedorm:transform:batch:log');
    // transaction transform logger
    debugTransformTransactionLog = debug('typedorm:transform:transaction:log');
    // scan transform logger
    debugTransformScanLog = debug('typedorm:transform:scan:log');
    // info logger
    debugInfoLog = debug('typedorm:info:log');
    debugWarnLog = debug('typedorm:warn:log');
    debugErrorLog = debug('typedorm:error:log');
    // stats logger
    debugStatsLog = debug('typedorm:stats:log');
    /**
     * Get unique request id for each request, and include it in each log
     * this allows for easy debugging
     * @returns unique request uuid
     */
    getRequestId() {
        return v4();
    }
    logTransform({ requestId, operation, prefix, entityName, primaryKey, body, options, }) {
        if (this.debugTransformLog.enabled) {
            this.debugTransformLog(`${chalk.bold.bgCyanBright(requestId)} ${chalk.green(operation)} ${chalk.blue(entityName)} ${chalk.magenta(prefix)}:`, ...(primaryKey
                ? [
                    chalk.blueBright('\nPrimary key: '),
                    chalk.white(this.ensurePrintable(primaryKey)),
                ]
                : []), ...(body
                ? [
                    chalk.blueBright('\nBody: '),
                    chalk.white(this.ensurePrintable(body)),
                ]
                : []), ...(options
                ? [
                    chalk.blueBright('\nOptions: '),
                    chalk.white(this.ensurePrintable(options)),
                ]
                : []));
        }
    }
    logTransformBatch({ requestId, operation, prefix, body, options, }) {
        if (this.debugTransformBatchLog.enabled) {
            this.debugTransformBatchLog(`${chalk.bold.bgCyanBright(requestId)} ${chalk.green(operation)} ${chalk.magenta(prefix)}:`, ...(body
                ? [
                    chalk.blueBright('\nBody: '),
                    chalk.white(this.ensurePrintable(body)),
                ]
                : []), ...(options
                ? [
                    chalk.blueBright('\nOptions: '),
                    chalk.white(this.ensurePrintable(options)),
                ]
                : []));
        }
    }
    logTransformTransaction({ requestId, operation, prefix, body, options, }) {
        if (this.debugTransformTransactionLog.enabled) {
            this.debugTransformTransactionLog(`${chalk.bold.bgCyanBright(requestId)} ${chalk.green(operation)} ${chalk.magenta(prefix)}:`, ...(body
                ? [
                    chalk.blueBright('\nBody: '),
                    chalk.white(this.ensurePrintable(body)),
                ]
                : []), ...(options
                ? [
                    chalk.blueBright('\nOptions: '),
                    chalk.white(this.ensurePrintable(options)),
                ]
                : []));
        }
    }
    logTransformScan({ requestId, prefix, operation, body, options, }) {
        if (this.debugTransformScanLog.enabled) {
            this.debugTransformScanLog(`${chalk.bold.bgCyanBright(requestId)} ${chalk.green(operation)} ${chalk.magenta(prefix)}:`, ...(body
                ? [
                    chalk.blueBright('\nBody: '),
                    chalk.white(this.ensurePrintable(body)),
                ]
                : []), ...(options
                ? [
                    chalk.blueBright('\nOptions: '),
                    chalk.white(this.ensurePrintable(options)),
                ]
                : []));
        }
    }
    logStats({ requestId, requestSegment, scope, statsType, consumedCapacityData, }) {
        if (this.debugStatsLog.enabled) {
            this.debugStatsLog(`${chalk.bold.bgCyanBright(requestId) +
                (requestSegment ? ':' + chalk.bold.bgCyanBright(requestId) : '')} ${chalk.green(scope)} ${chalk.magenta(statsType)}:`, chalk.white(this.ensurePrintable(consumedCapacityData)));
        }
    }
    logInfo({ requestId, scope, log, }) {
        if (this.debugInfoLog.enabled) {
            this.debugInfoLog(`${chalk.bold.bgCyanBright(requestId)} ${chalk.green(scope)}:`, chalk.white(this.ensurePrintable(log)));
        }
    }
    logWarn({ requestId, scope, log, }) {
        if (this.debugWarnLog.enabled) {
            this.debugWarnLog(`${chalk.bold.bgCyanBright(requestId)} ${chalk.green(scope)}:`, chalk.yellow(this.ensurePrintable(log)));
        }
    }
    logError({ requestId, scope, log, }) {
        if (this.debugErrorLog.enabled) {
            this.debugErrorLog(`${chalk.bold.bgCyanBright(requestId)} ${chalk.green(scope)}:`, chalk.red(this.ensurePrintable(log)));
        }
    }
    ensurePrintable(log) {
        if (typeof log === 'object' && log !== null) {
            return `\n${JSON.stringify(log, null, 2)}\n`;
        }
        else
            return log;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVidWctbG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvY29tbW9uL3NyYy9sb2dnZXIvZGVidWctbG9nZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMxQixPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxFQUFDLEVBQUUsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUV4QixNQUFNLENBQU4sSUFBWSxjQU9YO0FBUEQsV0FBWSxjQUFjO0lBQ3hCLDZCQUFXLENBQUE7SUFDWCw2QkFBVyxDQUFBO0lBQ1gsbUNBQWlCLENBQUE7SUFDakIsbUNBQWlCLENBQUE7SUFDakIsaUNBQWUsQ0FBQTtJQUNmLHVDQUFxQixDQUFBO0FBQ3ZCLENBQUMsRUFQVyxjQUFjLEtBQWQsY0FBYyxRQU96QjtBQUVELE1BQU0sQ0FBTixJQUFZLFlBS1g7QUFMRCxXQUFZLFlBQVk7SUFDdEIsaURBQWlDLENBQUE7SUFDakMsMkRBQTJDLENBQUE7SUFDM0MsK0NBQStCLENBQUE7SUFDL0IsNkNBQTZCLENBQUE7QUFDL0IsQ0FBQyxFQUxXLFlBQVksS0FBWixZQUFZLFFBS3ZCO0FBQ0QsTUFBTSxDQUFOLElBQVksMEJBR1g7QUFIRCxXQUFZLDBCQUEwQjtJQUNwQyxxRUFBdUMsQ0FBQTtJQUN2QyxtRUFBcUMsQ0FBQTtBQUN2QyxDQUFDLEVBSFcsMEJBQTBCLEtBQTFCLDBCQUEwQixRQUdyQztBQUVELE1BQU0sQ0FBTixJQUFZLG1CQUdYO0FBSEQsV0FBWSxtQkFBbUI7SUFDN0Isb0NBQWEsQ0FBQTtJQUNiLHNEQUErQixDQUFBO0FBQ2pDLENBQUMsRUFIVyxtQkFBbUIsS0FBbkIsbUJBQW1CLFFBRzlCO0FBRUQsTUFBTSxDQUFOLElBQVksb0JBR1g7QUFIRCxXQUFZLG9CQUFvQjtJQUM5QixtREFBMkIsQ0FBQTtJQUMzQixpREFB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Q0FBQyxhQUFhLENBQ2hCLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUM5RCxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FDckMsQ0FBQztTQUNIO0lBQ0gsQ0FBQztJQUVPLGVBQWUsQ0FBQyxHQUFRO1FBQzlCLElBQUksT0FBTyxHQUFHLEtBQUssUUFBUSxJQUFJLEdBQUcsS0FBSyxJQUFJLEVBQUU7WUFDM0MsT0FBTyxLQUFLLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDO1NBQzlDOztZQUFNLE9BQU8sR0FBRyxDQUFDO0lBQ3BCLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XG5pbXBvcnQgY2hhbGsgZnJvbSAnY2hhbGsnO1xuaW1wb3J0IHt2NH0gZnJvbSAndXVpZCc7XG5cbmV4cG9ydCBlbnVtIFRSQU5TRk9STV9UWVBFIHtcbiAgR0VUID0gJ0dFVCcsXG4gIFBVVCA9ICdQVVQnLFxuICBVUERBVEUgPSAnVVBEQVRFJyxcbiAgREVMRVRFID0gJ0RFTEVURScsXG4gIFFVRVJZID0gJ1FVRVJZJyxcbiAgUkVTUE9OU0UgPSAnUkVTUE9OU0UnLFxufVxuXG5leHBvcnQgZW51bSBNQU5BR0VSX05BTUUge1xuICBFTlRJVFlfTUFOQUdFUiA9ICdFTlRJVFkgTUFOQUdFUicsXG4gIFRSQU5TQUNUSU9OX01BTkFHRVIgPSAnVFJBTlNBQ1RJT04gTUFOQUdFUicsXG4gIEJBVENIX01BTkFHRVIgPSAnQkFUQ0ggTUFOQUdFUicsXG4gIFNDQU5fTUFOQUdFUiA9ICdTQ0FOX01BTkFHRVInLFxufVxuZXhwb3J0IGVudW0gVFJBTlNGT1JNX1RSQU5TQUNUSU9OX1RZUEUge1xuICBUUkFOU0FDVElPTl9XUklURSA9ICdUUkFOU0FDVElPTl9XUklURScsXG4gIFRSQU5TQUNUSU9OX1JFQUQgPSAnVFJBTlNBQ1RJT05fUkVBRCcsXG59XG5cbmV4cG9ydCBlbnVtIFRSQU5TRk9STV9TQ0FOX1RZUEUge1xuICBTQ0FOID0gJ1NDQU4nLFxuICBQQVJBTExFTF9TQ0FOID0gJ1BBUkFMTEVMX1NDQU4nLFxufVxuXG5leHBvcnQgZW51bSBUUkFOU0ZPUk1fQkFUQ0hfVFlQRSB7XG4gIEJBVENIX1dSSVRFID0gJ0JBVENIX1dSSVRFJyxcbiAgQkFUQ0hfUkVBRCA9ICdCQVRDSF9SRUFEJyxcbn1cblxuZXhwb3J0IGVudW0gU1RBVFNfVFlQRSB7XG4gIENPTlNVTUVEX0NBUEFDSVRZID0gJ0NPTlNVTUVEX0NBUEFDSVRZJyxcbn1cblxuZXhwb3J0IGNsYXNzIERlYnVnTG9nZ2VyIHtcbiAgLy8gbG9nXG4gIHByaXZhdGUgZGVidWdUcmFuc2Zvcm1Mb2cgPSBkZWJ1ZygndHlwZWRvcm06dHJhbnNmb3JtOmxvZycpO1xuICAvLyBiYXRjaCB0cmFuc2Zvcm0gbG9nZ2VyXG4gIHByaXZhdGUgZGVidWdUcmFuc2Zvcm1CYXRjaExvZyA9IGRlYnVnKCd0eXBlZG9ybTp0cmFuc2Zvcm06YmF0Y2g6bG9nJyk7XG4gIC8vIHRyYW5zYWN0aW9uIHRyYW5zZm9ybSBsb2dnZXJcbiAgcHJpdmF0ZSBkZWJ1Z1RyYW5zZm9ybVRyYW5zYWN0aW9uTG9nID0gZGVidWcoXG4gICAgJ3R5cGVkb3JtOnRyYW5zZm9ybTp0cmFuc2FjdGlvbjpsb2cnXG4gICk7XG4gIC8vIHNjYW4gdHJhbnNmb3JtIGxvZ2dlclxuICBwcml2YXRlIGRlYnVnVHJhbnNmb3JtU2NhbkxvZyA9IGRlYnVnKCd0eXBlZG9ybTp0cmFuc2Zvcm06c2Nhbjpsb2cnKTtcbiAgLy8gaW5mbyBsb2dnZXJcbiAgcHJpdmF0ZSBkZWJ1Z0luZm9Mb2cgPSBkZWJ1ZygndHlwZWRvcm06aW5mbzpsb2cnKTtcbiAgcHJpdmF0ZSBkZWJ1Z1dhcm5Mb2cgPSBkZWJ1ZygndHlwZWRvcm06d2Fybjpsb2cnKTtcbiAgcHJpdmF0ZSBkZWJ1Z0Vycm9yTG9nID0gZGVidWcoJ3R5cGVkb3JtOmVycm9yOmxvZycpO1xuICAvLyBzdGF0cyBsb2dnZXJcbiAgcHJpdmF0ZSBkZWJ1Z1N0YXRzTG9nID0gZGVidWcoJ3R5cGVkb3JtOnN0YXRzOmxvZycpO1xuXG4gIC8qKlxuICAgKiBHZXQgdW5pcXVlIHJlcXVlc3QgaWQgZm9yIGVhY2ggcmVxdWVzdCwgYW5kIGluY2x1ZGUgaXQgaW4gZWFjaCBsb2dcbiAgICogdGhpcyBhbGxvd3MgZm9yIGVhc3kgZGVidWdnaW5nXG4gICAqIEByZXR1cm5zIHVuaXF1ZSByZXF1ZXN0IHV1aWRcbiAgICovXG4gIGdldFJlcXVlc3RJZCgpIHtcbiAgICByZXR1cm4gdjQoKTtcbiAgfVxuXG4gIGxvZ1RyYW5zZm9ybSh7XG4gICAgcmVxdWVzdElkLFxuICAgIG9wZXJhdGlvbixcbiAgICBwcmVmaXgsXG4gICAgZW50aXR5TmFtZSxcbiAgICBwcmltYXJ5S2V5LFxuICAgIGJvZHksXG4gICAgb3B0aW9ucyxcbiAgfToge1xuICAgIHJlcXVlc3RJZD86IHN0cmluZztcbiAgICBvcGVyYXRpb246IFRSQU5TRk9STV9UWVBFO1xuICAgIHByZWZpeDogc3RyaW5nO1xuICAgIGVudGl0eU5hbWU6IHN0cmluZztcbiAgICBwcmltYXJ5S2V5OiBhbnk7XG4gICAgYm9keT86IGFueTtcbiAgICBvcHRpb25zPzogYW55O1xuICB9KSB7XG4gICAgaWYgKHRoaXMuZGVidWdUcmFuc2Zvcm1Mb2cuZW5hYmxlZCkge1xuICAgICAgdGhpcy5kZWJ1Z1RyYW5zZm9ybUxvZyhcbiAgICAgICAgYCR7Y2hhbGsuYm9sZC5iZ0N5YW5CcmlnaHQocmVxdWVzdElkKX0gJHtjaGFsay5ncmVlbihcbiAgICAgICAgICBvcGVyYXRpb25cbiAgICAgICAgKX0gJHtjaGFsay5ibHVlKGVudGl0eU5hbWUpfSAke2NoYWxrLm1hZ2VudGEocHJlZml4KX06YCxcbiAgICAgICAgLi4uKHByaW1hcnlLZXlcbiAgICAgICAgICA/IFtcbiAgICAgICAgICAgICAgY2hhbGsuYmx1ZUJyaWdodCgnXFxuUHJpbWFyeSBrZXk6ICcpLFxuICAgICAgICAgICAgICBjaGFsay53aGl0ZSh0aGlzLmVuc3VyZVByaW50YWJsZShwcmltYXJ5S2V5KSksXG4gICAgICAgICAgICBdXG4gICAgICAgICAgOiBbXSksXG4gICAgICAgIC4uLihib2R5XG4gICAgICAgICAgPyBbXG4gICAgICAgICAgICAgIGNoYWxrLmJsdWVCcmlnaHQoJ1xcbkJvZHk6ICcpLFxuICAgICAgICAgICAgICBjaGFsay53aGl0ZSh0aGlzLmVuc3VyZVByaW50YWJsZShib2R5KSksXG4gICAgICAgICAgICBdXG4gICAgICAgICAgOiBbXSksXG4gICAgICAgIC4uLihvcHRpb25zXG4gICAgICAgICAgPyBbXG4gICAgICAgICAgICAgIGNoYWxrLmJsdWVCcmlnaHQoJ1xcbk9wdGlvbnM6ICcpLFxuICAgICAgICAgICAgICBjaGFsay53aGl0ZSh0aGlzLmVuc3VyZVByaW50YWJsZShvcHRpb25zKSksXG4gICAgICAgICAgICBdXG4gICAgICAgICAgOiBbXSlcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgbG9nVHJhbnNmb3JtQmF0Y2goe1xuICAgIHJlcXVlc3RJZCxcbiAgICBvcGVyYXRpb24sXG4gICAgcHJlZml4LFxuICAgIGJvZHksXG4gICAgb3B0aW9ucyxcbiAgfToge1xuICAgIHJlcXVlc3RJZD86IHN0cmluZztcbiAgICBvcGVyYXRpb246IFRSQU5TRk9STV9CQVRDSF9UWVBFO1xuICAgIHByZWZpeDogc3RyaW5nO1xuICAgIGJvZHk/OiBhbnk7XG4gICAgb3B0aW9ucz86IGFueTtcbiAgfSkge1xuICAgIGlmICh0aGlzLmRlYnVnVHJhbnNmb3JtQmF0Y2hMb2cuZW5hYmxlZCkge1xuICAgICAgdGhpcy5kZWJ1Z1RyYW5zZm9ybUJhdGNoTG9nKFxuICAgICAgICBgJHtjaGFsay5ib2xkLmJnQ3lhbkJyaWdodChyZXF1ZXN0SWQpfSAke2NoYWxrLmdyZWVuKFxuICAgICAgICAgIG9wZXJhdGlvblxuICAgICAgICApfSAke2NoYWxrLm1hZ2VudGEocHJlZml4KX06YCxcbiAgICAgICAgLi4uKGJvZHlcbiAgICAgICAgICA/IFtcbiAgICAgICAgICAgICAgY2hhbGsuYmx1ZUJyaWdodCgnXFxuQm9keTogJyksXG4gICAgICAgICAgICAgIGNoYWxrLndoaXRlKHRoaXMuZW5zdXJlUHJpbnRhYmxlKGJvZHkpKSxcbiAgICAgICAgICAgIF1cbiAgICAgICAgICA6IFtdKSxcbiAgICAgICAgLi4uKG9wdGlvbnNcbiAgICAgICAgICA/IFtcbiAgICAgICAgICAgICAgY2hhbGsuYmx1ZUJyaWdodCgnXFxuT3B0aW9uczogJyksXG4gICAgICAgICAgICAgIGNoYWxrLndoaXRlKHRoaXMuZW5zdXJlUHJpbnRhYmxlKG9wdGlvbnMpKSxcbiAgICAgICAgICAgIF1cbiAgICAgICAgICA6IFtdKVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBsb2dUcmFuc2Zvcm1UcmFuc2FjdGlvbih7XG4gICAgcmVxdWVzdElkLFxuICAgIG9wZXJhdGlvbixcbiAgICBwcmVmaXgsXG4gICAgYm9keSxcbiAgICBvcHRpb25zLFxuICB9OiB7XG4gICAgcmVxdWVzdElkPzogc3RyaW5nO1xuICAgIG9wZXJhdGlvbjogVFJBTlNGT1JNX1RSQU5TQUNUSU9OX1RZUEU7XG4gICAgcHJlZml4OiBzdHJpbmc7XG4gICAgYm9keT86IGFueTtcbiAgICBvcHRpb25zPzogYW55O1xuICB9KSB7XG4gICAgaWYgKHRoaXMuZGVidWdUcmFuc2Zvcm1UcmFuc2FjdGlvbkxvZy5lbmFibGVkKSB7XG4gICAgICB0aGlzLmRlYnVnVHJhbnNmb3JtVHJhbnNhY3Rpb25Mb2coXG4gICAgICAgIGAke2NoYWxrLmJvbGQuYmdDeWFuQnJpZ2h0KHJlcXVlc3RJZCl9ICR7Y2hhbGsuZ3JlZW4oXG4gICAgICAgICAgb3BlcmF0aW9uXG4gICAgICAgICl9ICR7Y2hhbGsubWFnZW50YShwcmVmaXgpfTpgLFxuICAgICAgICAuLi4oYm9keVxuICAgICAgICAgID8gW1xuICAgICAgICAgICAgICBjaGFsay5ibHVlQnJpZ2h0KCdcXG5Cb2R5OiAnKSxcbiAgICAgICAgICAgICAgY2hhbGsud2hpdGUodGhpcy5lbnN1cmVQcmludGFibGUoYm9keSkpLFxuICAgICAgICAgICAgXVxuICAgICAgICAgIDogW10pLFxuICAgICAgICAuLi4ob3B0aW9uc1xuICAgICAgICAgID8gW1xuICAgICAgICAgICAgICBjaGFsay5ibHVlQnJpZ2h0KCdcXG5PcHRpb25zOiAnKSxcbiAgICAgICAgICAgICAgY2hhbGsud2hpdGUodGhpcy5lbnN1cmVQcmludGFibGUob3B0aW9ucykpLFxuICAgICAgICAgICAgXVxuICAgICAgICAgIDogW10pXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGxvZ1RyYW5zZm9ybVNjYW4oe1xuICAgIHJlcXVlc3RJZCxcbiAgICBwcmVmaXgsXG4gICAgb3BlcmF0aW9uLFxuICAgIGJvZHksXG4gICAgb3B0aW9ucyxcbiAgfToge1xuICAgIHJlcXVlc3RJZD86IHN0cmluZztcbiAgICBvcGVyYXRpb246IFRSQU5TRk9STV9TQ0FOX1RZUEU7XG4gICAgcHJlZml4OiBzdHJpbmc7XG4gICAgYm9keT86IGFueTtcbiAgICBvcHRpb25zPzogYW55O1xuICB9KSB7XG4gICAgaWYgKHRoaXMuZGVidWdUcmFuc2Zvcm1TY2FuTG9nLmVuYWJsZWQpIHtcbiAgICAgIHRoaXMuZGVidWdUcmFuc2Zvcm1TY2FuTG9nKFxuICAgICAgICBgJHtjaGFsay5ib2xkLmJnQ3lhbkJyaWdodChyZXF1ZXN0SWQpfSAke2NoYWxrLmdyZWVuKFxuICAgICAgICAgIG9wZXJhdGlvblxuICAgICAgICApfSAke2NoYWxrLm1hZ2VudGEocHJlZml4KX06YCxcbiAgICAgICAgLi4uKGJvZHlcbiAgICAgICAgICA/IFtcbiAgICAgICAgICAgICAgY2hhbGsuYmx1ZUJyaWdodCgnXFxuQm9keTogJyksXG4gICAgICAgICAgICAgIGNoYWxrLndoaXRlKHRoaXMuZW5zdXJlUHJpbnRhYmxlKGJvZHkpKSxcbiAgICAgICAgICAgIF1cbiAgICAgICAgICA6IFtdKSxcbiAgICAgICAgLi4uKG9wdGlvbnNcbiAgICAgICAgICA/IFtcbiAgICAgICAgICAgICAgY2hhbGsuYmx1ZUJyaWdodCgnXFxuT3B0aW9uczogJyksXG4gICAgICAgICAgICAgIGNoYWxrLndoaXRlKHRoaXMuZW5zdXJlUHJpbnRhYmxlKG9wdGlvbnMpKSxcbiAgICAgICAgICAgIF1cbiAgICAgICAgICA6IFtdKVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBsb2dTdGF0cyh7XG4gICAgcmVxdWVzdElkLFxuICAgIHJlcXVlc3RTZWdtZW50LFxuICAgIHNjb3BlLFxuICAgIHN0YXRzVHlwZSxcbiAgICBjb25zdW1lZENhcGFjaXR5RGF0YSxcbiAgfToge1xuICAgIHJlcXVlc3RJZD86IHN0cmluZztcbiAgICByZXF1ZXN0U2VnbWVudD86IG51bWJlcjsgLy8gaWYgZm9yIGFueSByZWFzb24sIHJlcXVlc3Qgd2FzIHNlZ21lbnRlZCBpbnRvIG11bHRpcGxlIHJlcXVlc3QsIHRoaXMgaW5kaWNhdGVzIHNlZ21lbnQgaW5kZXhcbiAgICBzY29wZTogTUFOQUdFUl9OQU1FO1xuICAgIHN0YXRzVHlwZTogU1RBVFNfVFlQRTtcbiAgICBjb25zdW1lZENhcGFjaXR5RGF0YTogYW55O1xuICB9KSB7XG4gICAgaWYgKHRoaXMuZGVidWdTdGF0c0xvZy5lbmFibGVkKSB7XG4gICAgICB0aGlzLmRlYnVnU3RhdHNMb2coXG4gICAgICAgIGAke1xuICAgICAgICAgIGNoYWxrLmJvbGQuYmdDeWFuQnJpZ2h0KHJlcXVlc3RJZCkgK1xuICAgICAgICAgIChyZXF1ZXN0U2VnbWVudCA/ICc6JyArIGNoYWxrLmJvbGQuYmdDeWFuQnJpZ2h0KHJlcXVlc3RJZCkgOiAnJylcbiAgICAgICAgfSAke2NoYWxrLmdyZWVuKHNjb3BlKX0gJHtjaGFsay5tYWdlbnRhKHN0YXRzVHlwZSl9OmAsXG4gICAgICAgIGNoYWxrLndoaXRlKHRoaXMuZW5zdXJlUHJpbnRhYmxlKGNvbnN1bWVkQ2FwYWNpdHlEYXRhKSlcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgbG9nSW5mbyh7XG4gICAgcmVxdWVzdElkLFxuICAgIHNjb3BlLFxuICAgIGxvZyxcbiAgfToge1xuICAgIHJlcXVlc3RJZD86IHN0cmluZztcbiAgICBzY29wZTogTUFOQUdFUl9OQU1FO1xuICAgIGxvZzogc3RyaW5nO1xuICB9KSB7XG4gICAgaWYgKHRoaXMuZGVidWdJbmZvTG9nLmVuYWJsZWQpIHtcbiAgICAgIHRoaXMuZGVidWdJbmZvTG9nKFxuICAgICAgICBgJHtjaGFsay5ib2xkLmJnQ3lhbkJyaWdodChyZXF1ZXN0SWQpfSAke2NoYWxrLmdyZWVuKHNjb3BlKX06YCxcbiAgICAgICAgY2hhbGsud2hpdGUodGhpcy5lbnN1cmVQcmludGFibGUobG9nKSlcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgbG9nV2Fybih7XG4gICAgcmVxdWVzdElkLFxuICAgIHNjb3BlLFxuICAgIGxvZyxcbiAgfToge1xuICAgIHJlcXVlc3RJZD86IHN0cmluZztcbiAgICBzY29wZTogTUFOQUdFUl9OQU1FO1xuICAgIGxvZzogc3RyaW5nO1xuICB9KSB7XG4gICAgaWYgKHRoaXMuZGVidWdXYXJuTG9nLmVuYWJsZWQpIHtcbiAgICAgIHRoaXMuZGVidWdXYXJuTG9nKFxuICAgICAgICBgJHtjaGFsay5ib2xkLmJnQ3lhbkJyaWdodChyZXF1ZXN0SWQpfSAke2NoYWxrLmdyZWVuKHNjb3BlKX06YCxcbiAgICAgICAgY2hhbGsueWVsbG93KHRoaXMuZW5zdXJlUHJpbnRhYmxlKGxvZykpXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGxvZ0Vycm9yKHtcbiAgICByZXF1ZXN0SWQsXG4gICAgc2NvcGUsXG4gICAgbG9nLFxuICB9OiB7XG4gICAgcmVxdWVzdElkPzogc3RyaW5nO1xuICAgIHNjb3BlOiBNQU5BR0VSX05BTUU7XG4gICAgbG9nOiBhbnk7XG4gIH0pIHtcbiAgICBpZiAodGhpcy5kZWJ1Z0Vycm9yTG9nLmVuYWJsZWQpIHtcbiAgICAgIHRoaXMuZGVidWdFcnJvckxvZyhcbiAgICAgICAgYCR7Y2hhbGsuYm9sZC5iZ0N5YW5CcmlnaHQocmVxdWVzdElkKX0gJHtjaGFsay5ncmVlbihzY29wZSl9OmAsXG4gICAgICAgIGNoYWxrLnJlZCh0aGlzLmVuc3VyZVByaW50YWJsZShsb2cpKVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGVuc3VyZVByaW50YWJsZShsb2c6IGFueSkge1xuICAgIGlmICh0eXBlb2YgbG9nID09PSAnb2JqZWN0JyAmJiBsb2cgIT09IG51bGwpIHtcbiAgICAgIHJldHVybiBgXFxuJHtKU09OLnN0cmluZ2lmeShsb2csIG51bGwsIDIpfVxcbmA7XG4gICAgfSBlbHNlIHJldHVybiBsb2c7XG4gIH1cbn1cbiJdfQ==