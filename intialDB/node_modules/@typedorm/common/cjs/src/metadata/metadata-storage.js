"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MetadataStorage = exports.IsAutoGenerateAttributeRawMetadataOptions = void 0;
const IsAutoGenerateAttributeRawMetadataOptions = (attr) => !!attr.strategy;
exports.IsAutoGenerateAttributeRawMetadataOptions = IsAutoGenerateAttributeRawMetadataOptions;
class MetadataStorage {
    constructor() {
        this._entities = new Map();
        this._attributes = new Map();
    }
    /**
     * Get entity metadata by entity physical name
     * Physical name refers to value set to "name" property on @Entity
     * @param name entity physical name
     */
    getEntityByName(name) {
        return this.entities.find(en => en.name === name);
    }
    hasKnownEntity(entityClass) {
        return this._entities.has(entityClass);
    }
    getRawAttributesForEntity(entityClass) {
        var _a;
        const attributes = (_a = this._attributes.get(entityClass)) === null || _a === void 0 ? void 0 : _a.values();
        if (!attributes) {
            // it is possible that entity might not have any attributes referenced such cases are
            // when inherited entity contains all the attribute declarations and derived ones only defines schema for it
            // Thus, instead of throwing an error, simply return [] list to continue processing other attributes
            return [];
        }
        return Array.from(attributes);
    }
    getRawEntityByTarget(entityClass) {
        const entity = this._entities.get(entityClass);
        if (!entity) {
            throw new Error(`No entity with name "${entityClass.name}" could be resolved, 
      make sure they have been declared at the connection creation time.`);
        }
        return entity;
    }
    addRawAttribute(entityClass, attribute) {
        let attributesForEntity = this._attributes.get(entityClass);
        if (!attributesForEntity) {
            attributesForEntity = new Map();
        }
        attributesForEntity.set(attribute.name, attribute);
        this._attributes.set(entityClass, attributesForEntity);
    }
    addRawEntity(entity) {
        this._entities.set(entity.target, entity);
    }
    get entities() {
        return Array.from(this._entities.values());
    }
    get attributes() {
        return Array.from(this._attributes.values()).map(attr => Array.from(attr.values()));
    }
}
exports.MetadataStorage = MetadataStorage;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWRhdGEtc3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL2NvbW1vbi9zcmMvbWV0YWRhdGEvbWV0YWRhdGEtc3RvcmFnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFNTyxNQUFNLHlDQUF5QyxHQUFHLENBQ3ZELElBQVMsRUFDd0MsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO0FBRnpELFFBQUEseUNBQXlDLDZDQUVnQjtBQTRDdEUsTUFBYSxlQUFlO0lBVTFCO1FBQ0UsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUMvQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGVBQWUsQ0FBQyxJQUFZO1FBQzFCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRCxjQUFjLENBQVMsV0FBaUM7UUFDdEQsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQseUJBQXlCLENBQVMsV0FBaUM7O1FBQ2pFLE1BQU0sVUFBVSxHQUFHLE1BQUEsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLDBDQUFFLE1BQU0sRUFBRSxDQUFDO1FBRS9ELElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDZixxRkFBcUY7WUFDckYsNEdBQTRHO1lBQzVHLG9HQUFvRztZQUNwRyxPQUFPLEVBQUUsQ0FBQztTQUNYO1FBQ0QsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFRCxvQkFBb0IsQ0FBUyxXQUFpQztRQUM1RCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUUvQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ1gsTUFBTSxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsV0FBVyxDQUFDLElBQUk7eUVBQ1csQ0FBQyxDQUFDO1NBQ3RFO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVELGVBQWUsQ0FDYixXQUFpQyxFQUNqQyxTQUFzQztRQUV0QyxJQUFJLG1CQUFtQixHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRTVELElBQUksQ0FBQyxtQkFBbUIsRUFBRTtZQUN4QixtQkFBbUIsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1NBQ2pDO1FBRUQsbUJBQW1CLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDbkQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLG1CQUFtQixDQUFDLENBQUM7SUFDekQsQ0FBQztJQUVELFlBQVksQ0FBQyxNQUFnQztRQUMzQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFRCxJQUFJLFFBQVE7UUFDVixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQzdDLENBQUM7SUFFRCxJQUFJLFVBQVU7UUFDWixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUN0RCxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUMxQixDQUFDO0lBQ0osQ0FBQztDQUNGO0FBN0VELDBDQTZFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7QVVUT19HRU5FUkFURV9BVFRSSUJVVEVfU1RSQVRFR1ksIEVudGl0eVRhcmdldH0gZnJvbSAnQHR5cGVkb3JtL2NvbW1vbic7XG5pbXBvcnQge1RhYmxlfSBmcm9tICcuLi90YWJsZSc7XG5pbXBvcnQge0F0dHJpYnV0ZU9wdGlvbnNVbmlxdWVUeXBlfSBmcm9tICcuLi9kZWNvcmF0b3JzL2F0dHJpYnV0ZS5kZWNvcmF0b3InO1xuaW1wb3J0IHtTY2FsYXJUeXBlfSBmcm9tICcuLi9oZWxwZXJzL3NjYWxhci10eXBlJztcbmltcG9ydCB7RW50aXR5QWxpYXNPclN0cmluZywgSW5kZXhPcHRpb25zV2l0aEFsaWFzfSBmcm9tICcuLi9pbmRleC1vcHRpb25zJztcblxuZXhwb3J0IGNvbnN0IElzQXV0b0dlbmVyYXRlQXR0cmlidXRlUmF3TWV0YWRhdGFPcHRpb25zID0gKFxuICBhdHRyOiBhbnlcbik6IGF0dHIgaXMgQXV0b0dlbmVyYXRlQXR0cmlidXRlUmF3TWV0YWRhdGFPcHRpb25zID0+ICEhYXR0ci5zdHJhdGVneTtcblxuZXhwb3J0IHR5cGUgUHJpbWFyeUtleTxFbnRpdHkgPSBhbnk+ID1cbiAgfCBTaW1wbGVQcmltYXJ5S2V5PEVudGl0eT5cbiAgfCBDb21wb3NpdGVQcmltYXJ5S2V5PEVudGl0eT47XG5cbmV4cG9ydCB0eXBlIFNpbXBsZVByaW1hcnlLZXk8RW50aXR5ID0gYW55PiA9IHtcbiAgcGFydGl0aW9uS2V5OiBFbnRpdHlBbGlhc09yU3RyaW5nPEVudGl0eT47XG59O1xuXG5leHBvcnQgdHlwZSBDb21wb3NpdGVQcmltYXJ5S2V5PEVudGl0eSA9IGFueT4gPSB7XG4gIHBhcnRpdGlvbktleTogRW50aXR5QWxpYXNPclN0cmluZzxFbnRpdHk+O1xuICBzb3J0S2V5OiBFbnRpdHlBbGlhc09yU3RyaW5nPEVudGl0eT47XG59O1xuXG5leHBvcnQgdHlwZSBJbmRleGVzPEVudGl0eSA9IGFueT4gPSB7XG4gIFtrZXk6IHN0cmluZ106IEluZGV4T3B0aW9uc1dpdGhBbGlhczxFbnRpdHk+O1xufTtcblxuZXhwb3J0IGludGVyZmFjZSBFbnRpdHlSYXdNZXRhZGF0YU9wdGlvbnM8RW50aXR5ID0gYW55PiB7XG4gIG5hbWU6IHN0cmluZztcbiAgdGFyZ2V0OiBFbnRpdHlUYXJnZXQ8RW50aXR5PjtcbiAgcHJpbWFyeUtleTogUHJpbWFyeUtleTxFbnRpdHk+O1xuICBpbmRleGVzPzogSW5kZXhlczxFbnRpdHk+O1xuICB0YWJsZT86IFRhYmxlO1xufVxuXG5pbnRlcmZhY2UgQmFzZUF0dHJpYnV0ZVJhd01ldGFkYXRhT3B0aW9ucyB7XG4gIG5hbWU6IHN0cmluZztcbiAgdHlwZTogYW55O1xuICBoaWRkZW4/OiBib29sZWFuO1xufVxuZXhwb3J0IGludGVyZmFjZSBBdHRyaWJ1dGVSYXdNZXRhZGF0YU9wdGlvbnNcbiAgZXh0ZW5kcyBCYXNlQXR0cmlidXRlUmF3TWV0YWRhdGFPcHRpb25zIHtcbiAgdW5pcXVlPzogQXR0cmlidXRlT3B0aW9uc1VuaXF1ZVR5cGU7XG4gIGRlZmF1bHQ/OiBTY2FsYXJUeXBlIHwgKCgpID0+IFNjYWxhclR5cGUpO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dG9HZW5lcmF0ZUF0dHJpYnV0ZVJhd01ldGFkYXRhT3B0aW9uc1xuICBleHRlbmRzIEJhc2VBdHRyaWJ1dGVSYXdNZXRhZGF0YU9wdGlvbnMge1xuICBzdHJhdGVneTogQVVUT19HRU5FUkFURV9BVFRSSUJVVEVfU1RSQVRFR1k7XG4gIGF1dG9VcGRhdGU/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgTWV0YWRhdGFTdG9yYWdlIHtcbiAgcHJpdmF0ZSBfZW50aXRpZXM6IE1hcDxFbnRpdHlUYXJnZXQ8YW55PiwgRW50aXR5UmF3TWV0YWRhdGFPcHRpb25zPjtcbiAgcHJpdmF0ZSBfYXR0cmlidXRlczogTWFwPFxuICAgIEVudGl0eVRhcmdldDxhbnk+LFxuICAgIE1hcDxcbiAgICAgIHN0cmluZyxcbiAgICAgIEF0dHJpYnV0ZVJhd01ldGFkYXRhT3B0aW9ucyB8IEF1dG9HZW5lcmF0ZUF0dHJpYnV0ZVJhd01ldGFkYXRhT3B0aW9uc1xuICAgID5cbiAgPjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9lbnRpdGllcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLl9hdHRyaWJ1dGVzID0gbmV3IE1hcCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBlbnRpdHkgbWV0YWRhdGEgYnkgZW50aXR5IHBoeXNpY2FsIG5hbWVcbiAgICogUGh5c2ljYWwgbmFtZSByZWZlcnMgdG8gdmFsdWUgc2V0IHRvIFwibmFtZVwiIHByb3BlcnR5IG9uIEBFbnRpdHlcbiAgICogQHBhcmFtIG5hbWUgZW50aXR5IHBoeXNpY2FsIG5hbWVcbiAgICovXG4gIGdldEVudGl0eUJ5TmFtZShuYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5lbnRpdGllcy5maW5kKGVuID0+IGVuLm5hbWUgPT09IG5hbWUpO1xuICB9XG5cbiAgaGFzS25vd25FbnRpdHk8RW50aXR5PihlbnRpdHlDbGFzczogRW50aXR5VGFyZ2V0PEVudGl0eT4pIHtcbiAgICByZXR1cm4gdGhpcy5fZW50aXRpZXMuaGFzKGVudGl0eUNsYXNzKTtcbiAgfVxuXG4gIGdldFJhd0F0dHJpYnV0ZXNGb3JFbnRpdHk8RW50aXR5PihlbnRpdHlDbGFzczogRW50aXR5VGFyZ2V0PEVudGl0eT4pIHtcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0gdGhpcy5fYXR0cmlidXRlcy5nZXQoZW50aXR5Q2xhc3MpPy52YWx1ZXMoKTtcblxuICAgIGlmICghYXR0cmlidXRlcykge1xuICAgICAgLy8gaXQgaXMgcG9zc2libGUgdGhhdCBlbnRpdHkgbWlnaHQgbm90IGhhdmUgYW55IGF0dHJpYnV0ZXMgcmVmZXJlbmNlZCBzdWNoIGNhc2VzIGFyZVxuICAgICAgLy8gd2hlbiBpbmhlcml0ZWQgZW50aXR5IGNvbnRhaW5zIGFsbCB0aGUgYXR0cmlidXRlIGRlY2xhcmF0aW9ucyBhbmQgZGVyaXZlZCBvbmVzIG9ubHkgZGVmaW5lcyBzY2hlbWEgZm9yIGl0XG4gICAgICAvLyBUaHVzLCBpbnN0ZWFkIG9mIHRocm93aW5nIGFuIGVycm9yLCBzaW1wbHkgcmV0dXJuIFtdIGxpc3QgdG8gY29udGludWUgcHJvY2Vzc2luZyBvdGhlciBhdHRyaWJ1dGVzXG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIHJldHVybiBBcnJheS5mcm9tKGF0dHJpYnV0ZXMpO1xuICB9XG5cbiAgZ2V0UmF3RW50aXR5QnlUYXJnZXQ8RW50aXR5PihlbnRpdHlDbGFzczogRW50aXR5VGFyZ2V0PEVudGl0eT4pIHtcbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLl9lbnRpdGllcy5nZXQoZW50aXR5Q2xhc3MpO1xuXG4gICAgaWYgKCFlbnRpdHkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gZW50aXR5IHdpdGggbmFtZSBcIiR7ZW50aXR5Q2xhc3MubmFtZX1cIiBjb3VsZCBiZSByZXNvbHZlZCwgXG4gICAgICBtYWtlIHN1cmUgdGhleSBoYXZlIGJlZW4gZGVjbGFyZWQgYXQgdGhlIGNvbm5lY3Rpb24gY3JlYXRpb24gdGltZS5gKTtcbiAgICB9XG4gICAgcmV0dXJuIGVudGl0eTtcbiAgfVxuXG4gIGFkZFJhd0F0dHJpYnV0ZTxFbnRpdHk+KFxuICAgIGVudGl0eUNsYXNzOiBFbnRpdHlUYXJnZXQ8RW50aXR5PixcbiAgICBhdHRyaWJ1dGU6IEF0dHJpYnV0ZVJhd01ldGFkYXRhT3B0aW9uc1xuICApIHtcbiAgICBsZXQgYXR0cmlidXRlc0ZvckVudGl0eSA9IHRoaXMuX2F0dHJpYnV0ZXMuZ2V0KGVudGl0eUNsYXNzKTtcblxuICAgIGlmICghYXR0cmlidXRlc0ZvckVudGl0eSkge1xuICAgICAgYXR0cmlidXRlc0ZvckVudGl0eSA9IG5ldyBNYXAoKTtcbiAgICB9XG5cbiAgICBhdHRyaWJ1dGVzRm9yRW50aXR5LnNldChhdHRyaWJ1dGUubmFtZSwgYXR0cmlidXRlKTtcbiAgICB0aGlzLl9hdHRyaWJ1dGVzLnNldChlbnRpdHlDbGFzcywgYXR0cmlidXRlc0ZvckVudGl0eSk7XG4gIH1cblxuICBhZGRSYXdFbnRpdHkoZW50aXR5OiBFbnRpdHlSYXdNZXRhZGF0YU9wdGlvbnMpIHtcbiAgICB0aGlzLl9lbnRpdGllcy5zZXQoZW50aXR5LnRhcmdldCwgZW50aXR5KTtcbiAgfVxuXG4gIGdldCBlbnRpdGllcygpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLl9lbnRpdGllcy52YWx1ZXMoKSk7XG4gIH1cblxuICBnZXQgYXR0cmlidXRlcygpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLl9hdHRyaWJ1dGVzLnZhbHVlcygpKS5tYXAoYXR0ciA9PlxuICAgICAgQXJyYXkuZnJvbShhdHRyLnZhbHVlcygpKVxuICAgICk7XG4gIH1cbn1cbiJdfQ==