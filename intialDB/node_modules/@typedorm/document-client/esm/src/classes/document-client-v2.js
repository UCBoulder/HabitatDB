import { TransactionCancelledException } from '../exceptions';
import { DocumentClient } from './base-document-client';
export class DocumentClientV2 extends DocumentClient {
    documentClient;
    version = 2;
    constructor(dynamoDBClient) {
        super();
        this.documentClient = dynamoDBClient;
    }
    async put(input) {
        return this.documentClient.put(input).promise();
    }
    async get(input) {
        return this.documentClient.get(input).promise();
    }
    async query(input) {
        return this.documentClient.query(input).promise();
    }
    async update(input) {
        return this.documentClient.update(input).promise();
    }
    async delete(input) {
        return this.documentClient.delete(input).promise();
    }
    async batchWrite(input) {
        return this.documentClient.batchWrite(input).promise();
    }
    async batchGet(input) {
        return this.documentClient.batchGet(input).promise();
    }
    async transactGet(input) {
        const transactionResult = this.transactGetRaw(input);
        return this.handleTransactionResult(transactionResult);
    }
    async transactWrite(input) {
        const transactionResult = this.transactWriteRaw(input);
        return this.handleTransactionResult(transactionResult);
    }
    async scan(input) {
        return this.documentClient.scan(input).promise();
    }
    ///
    /// Private Methods
    ///
    transactGetRaw(input) {
        return this.documentClient.transactGet(input);
    }
    transactWriteRaw(input) {
        return this.documentClient.transactWrite(input);
    }
    handleTransactionResult(transactionRequest) {
        let cancellationReasons;
        transactionRequest.on('extractError', response => {
            try {
                cancellationReasons = JSON.parse(response.httpResponse.body.toString()).CancellationReasons;
            }
            catch (err) {
                // suppress this just in case some types of errors aren't JSON parsable
                console.error('Error extracting cancellation error', err);
            }
        });
        return new Promise((resolve, reject) => {
            transactionRequest.send((err, response) => {
                if (err) {
                    // pull all reasons from response and map them to errors
                    const reasons = cancellationReasons.map(reason => {
                        return {
                            code: reason.Code,
                            message: reason.Message,
                            item: reason.Item,
                        };
                    });
                    return reject(new TransactionCancelledException(err.code, reasons));
                }
                return resolve(response);
            });
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9jdW1lbnQtY2xpZW50LXYyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvZG9jdW1lbnQtY2xpZW50L3NyYy9jbGFzc2VzL2RvY3VtZW50LWNsaWVudC12Mi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUMsNkJBQTZCLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDNUQsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLHdCQUF3QixDQUFDO0FBQ3RELE1BQU0sT0FBTyxnQkFFWCxTQUFRLGNBQWM7SUFDYixjQUFjLENBQXFCO0lBQ25DLE9BQU8sR0FBRyxDQUFDLENBQUM7SUFFckIsWUFBWSxjQUFrQztRQUM1QyxLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxjQUFjLEdBQUcsY0FBYyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxLQUFLLENBQUMsR0FBRyxDQUNQLEtBQTJDO1FBRTNDLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDbEQsQ0FBQztJQUVELEtBQUssQ0FBQyxHQUFHLENBQ1AsS0FBMkM7UUFFM0MsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNsRCxDQUFDO0lBRUQsS0FBSyxDQUFDLEtBQUssQ0FDVCxLQUF5QztRQUV6QyxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ3BELENBQUM7SUFFRCxLQUFLLENBQUMsTUFBTSxDQUNWLEtBQThDO1FBRTlDLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDckQsQ0FBQztJQUVELEtBQUssQ0FBQyxNQUFNLENBQ1Ys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c291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtBV1NFcnJvciwgRHluYW1vREIsIFJlcXVlc3R9IGZyb20gJ2F3cy1zZGsnO1xuaW1wb3J0IHtUcmFuc2FjdGlvbkNhbmNlbGxlZEV4Y2VwdGlvbn0gZnJvbSAnLi4vZXhjZXB0aW9ucyc7XG5pbXBvcnQge0RvY3VtZW50Q2xpZW50fSBmcm9tICcuL2Jhc2UtZG9jdW1lbnQtY2xpZW50JztcbmV4cG9ydCBjbGFzcyBEb2N1bWVudENsaWVudFYyPFxuICBEb2N1bWVudENsaWVudFR5cGUgZXh0ZW5kcyBEeW5hbW9EQi5Eb2N1bWVudENsaWVudCA9IER5bmFtb0RCLkRvY3VtZW50Q2xpZW50XG4+IGV4dGVuZHMgRG9jdW1lbnRDbGllbnQge1xuICByZWFkb25seSBkb2N1bWVudENsaWVudDogRG9jdW1lbnRDbGllbnRUeXBlO1xuICByZWFkb25seSB2ZXJzaW9uID0gMjtcblxuICBjb25zdHJ1Y3RvcihkeW5hbW9EQkNsaWVudDogRG9jdW1lbnRDbGllbnRUeXBlKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmRvY3VtZW50Q2xpZW50ID0gZHluYW1vREJDbGllbnQ7XG4gIH1cblxuICBhc3luYyBwdXQoXG4gICAgaW5wdXQ6IER5bmFtb0RCLkRvY3VtZW50Q2xpZW50LlB1dEl0ZW1JbnB1dFxuICApOiBQcm9taXNlPER5bmFtb0RCLkRvY3VtZW50Q2xpZW50LlB1dEl0ZW1PdXRwdXQ+IHtcbiAgICByZXR1cm4gdGhpcy5kb2N1bWVudENsaWVudC5wdXQoaW5wdXQpLnByb21pc2UoKTtcbiAgfVxuXG4gIGFzeW5jIGdldChcbiAgICBpbnB1dDogRHluYW1vREIuRG9jdW1lbnRDbGllbnQuR2V0SXRlbUlucHV0XG4gICk6IFByb21pc2U8RHluYW1vREIuRG9jdW1lbnRDbGllbnQuR2V0SXRlbU91dHB1dD4ge1xuICAgIHJldHVybiB0aGlzLmRvY3VtZW50Q2xpZW50LmdldChpbnB1dCkucHJvbWlzZSgpO1xuICB9XG5cbiAgYXN5bmMgcXVlcnkoXG4gICAgaW5wdXQ6IER5bmFtb0RCLkRvY3VtZW50Q2xpZW50LlF1ZXJ5SW5wdXRcbiAgKTogUHJvbWlzZTxEeW5hbW9EQi5Eb2N1bWVudENsaWVudC5RdWVyeU91dHB1dD4ge1xuICAgIHJldHVybiB0aGlzLmRvY3VtZW50Q2xpZW50LnF1ZXJ5KGlucHV0KS5wcm9taXNlKCk7XG4gIH1cblxuICBhc3luYyB1cGRhdGUoXG4gICAgaW5wdXQ6IER5bmFtb0RCLkRvY3VtZW50Q2xpZW50LlVwZGF0ZUl0ZW1JbnB1dFxuICApOiBQcm9taXNlPER5bmFtb0RCLkRvY3VtZW50Q2xpZW50LlVwZGF0ZUl0ZW1PdXRwdXQ+IHtcbiAgICByZXR1cm4gdGhpcy5kb2N1bWVudENsaWVudC51cGRhdGUoaW5wdXQpLnByb21pc2UoKTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZShcbiAgICBpbnB1dDogRHluYW1vREIuRG9jdW1lbnRDbGllbnQuRGVsZXRlSXRlbUlucHV0XG4gICk6IFByb21pc2U8RHluYW1vREIuRG9jdW1lbnRDbGllbnQuRGVsZXRlSXRlbU91dHB1dD4ge1xuICAgIHJldHVybiB0aGlzLmRvY3VtZW50Q2xpZW50LmRlbGV0ZShpbnB1dCkucHJvbWlzZSgpO1xuICB9XG5cbiAgYXN5bmMgYmF0Y2hXcml0ZShcbiAgICBpbnB1dDogRHluYW1vREIuRG9jdW1lbnRDbGllbnQuQmF0Y2hXcml0ZUl0ZW1JbnB1dFxuICApOiBQcm9taXNlPER5bmFtb0RCLkRvY3VtZW50Q2xpZW50LkJhdGNoV3JpdGVJdGVtT3V0cHV0PiB7XG4gICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRDbGllbnQuYmF0Y2hXcml0ZShpbnB1dCkucHJvbWlzZSgpO1xuICB9XG5cbiAgYXN5bmMgYmF0Y2hHZXQoXG4gICAgaW5wdXQ6IER5bmFtb0RCLkRvY3VtZW50Q2xpZW50LkJhdGNoR2V0SXRlbUlucHV0XG4gICk6IFByb21pc2U8RHluYW1vREIuRG9jdW1lbnRDbGllbnQuQmF0Y2hHZXRJdGVtT3V0cHV0PiB7XG4gICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRDbGllbnQuYmF0Y2hHZXQoaW5wdXQpLnByb21pc2UoKTtcbiAgfVxuXG4gIGFzeW5jIHRyYW5zYWN0R2V0KFxuICAgIGlucHV0OiBEeW5hbW9EQi5Eb2N1bWVudENsaWVudC5UcmFuc2FjdEdldEl0ZW1zSW5wdXRcbiAgKTogUHJvbWlzZTxEeW5hbW9EQi5Eb2N1bWVudENsaWVudC5UcmFuc2FjdEdldEl0ZW1zT3V0cHV0PiB7XG4gICAgY29uc3QgdHJhbnNhY3Rpb25SZXN1bHQgPSB0aGlzLnRyYW5zYWN0R2V0UmF3KGlucHV0KTtcbiAgICByZXR1cm4gdGhpcy5oYW5kbGVUcmFuc2FjdGlvblJlc3VsdCh0cmFuc2FjdGlvblJlc3VsdCk7XG4gIH1cblxuICBhc3luYyB0cmFuc2FjdFdyaXRlKFxuICAgIGlucHV0OiBEeW5hbW9EQi5Eb2N1bWVudENsaWVudC5UcmFuc2FjdFdyaXRlSXRlbXNJbnB1dFxuICApOiBQcm9taXNlPER5bmFtb0RCLkRvY3VtZW50Q2xpZW50LlRyYW5zYWN0V3JpdGVJdGVtc091dHB1dD4ge1xuICAgIGNvbnN0IHRyYW5zYWN0aW9uUmVzdWx0ID0gdGhpcy50cmFuc2FjdFdyaXRlUmF3KGlucHV0KTtcbiAgICByZXR1cm4gdGhpcy5oYW5kbGVUcmFuc2FjdGlvblJlc3VsdCh0cmFuc2FjdGlvblJlc3VsdCk7XG4gIH1cblxuICBhc3luYyBzY2FuKFxuICAgIGlucHV0OiBEeW5hbW9EQi5Eb2N1bWVudENsaWVudC5TY2FuSW5wdXRcbiAgKTogUHJvbWlzZTxEeW5hbW9EQi5Eb2N1bWVudENsaWVudC5TY2FuT3V0cHV0PiB7XG4gICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRDbGllbnQuc2NhbihpbnB1dCkucHJvbWlzZSgpO1xuICB9XG5cbiAgLy8vXG4gIC8vLyBQcml2YXRlIE1ldGhvZHNcbiAgLy8vXG4gIHByaXZhdGUgdHJhbnNhY3RHZXRSYXcoXG4gICAgaW5wdXQ6IER5bmFtb0RCLkRvY3VtZW50Q2xpZW50LlRyYW5zYWN0R2V0SXRlbXNJbnB1dFxuICApOiBSZXF1ZXN0PER5bmFtb0RCLkRvY3VtZW50Q2xpZW50LlRyYW5zYWN0R2V0SXRlbXNPdXRwdXQsIEFXU0Vycm9yPiB7XG4gICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRDbGllbnQudHJhbnNhY3RHZXQoaW5wdXQpO1xuICB9XG5cbiAgcHJpdmF0ZSB0cmFuc2FjdFdyaXRlUmF3KFxuICAgIGlucHV0OiBEeW5hbW9EQi5Eb2N1bWVudENsaWVudC5UcmFuc2FjdFdyaXRlSXRlbXNJbnB1dFxuICApOiBSZXF1ZXN0PER5bmFtb0RCLkRvY3VtZW50Q2xpZW50LlRyYW5zYWN0V3JpdGVJdGVtc091dHB1dCwgQVdTRXJyb3I+IHtcbiAgICByZXR1cm4gdGhpcy5kb2N1bWVudENsaWVudC50cmFuc2FjdFdyaXRlKGlucHV0KTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlVHJhbnNhY3Rpb25SZXN1bHQ8VD4odHJhbnNhY3Rpb25SZXF1ZXN0OiBSZXF1ZXN0PFQsIEFXU0Vycm9yPikge1xuICAgIGxldCBjYW5jZWxsYXRpb25SZWFzb25zOiB7XG4gICAgICBDb2RlOiBzdHJpbmc7XG4gICAgICBNZXNzYWdlOiBzdHJpbmc7XG4gICAgICBJdGVtOiBEeW5hbW9EQi5Eb2N1bWVudENsaWVudC5BdHRyaWJ1dGVNYXA7XG4gICAgfVtdO1xuICAgIHRyYW5zYWN0aW9uUmVxdWVzdC5vbignZXh0cmFjdEVycm9yJywgcmVzcG9uc2UgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY2FuY2VsbGF0aW9uUmVhc29ucyA9IEpTT04ucGFyc2UoXG4gICAgICAgICAgcmVzcG9uc2UuaHR0cFJlc3BvbnNlLmJvZHkudG9TdHJpbmcoKVxuICAgICAgICApLkNhbmNlbGxhdGlvblJlYXNvbnM7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gc3VwcHJlc3MgdGhpcyBqdXN0IGluIGNhc2Ugc29tZSB0eXBlcyBvZiBlcnJvcnMgYXJlbid0IEpTT04gcGFyc2FibGVcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZXh0cmFjdGluZyBjYW5jZWxsYXRpb24gZXJyb3InLCBlcnIpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRyYW5zYWN0aW9uUmVxdWVzdC5zZW5kKChlcnIsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAvLyBwdWxsIGFsbCByZWFzb25zIGZyb20gcmVzcG9uc2UgYW5kIG1hcCB0aGVtIHRvIGVycm9yc1xuICAgICAgICAgIGNvbnN0IHJlYXNvbnMgPSBjYW5jZWxsYXRpb25SZWFzb25zLm1hcChyZWFzb24gPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgY29kZTogcmVhc29uLkNvZGUsXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IHJlYXNvbi5NZXNzYWdlLFxuICAgICAgICAgICAgICBpdGVtOiByZWFzb24uSXRlbSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChuZXcgVHJhbnNhY3Rpb25DYW5jZWxsZWRFeGNlcHRpb24oZXJyLmNvZGUsIHJlYXNvbnMpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgIH0pO1xuICAgIH0pIGFzIFByb21pc2U8VD47XG4gIH1cbn1cbiJdfQ==