"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConnectionManager = void 0;
const connection_1 = require("./connection");
class ConnectionManager {
    constructor() {
        this.connections = new Map();
    }
    get(name = 'default') {
        const connection = this.connections.get(name);
        if (!connection) {
            throw new Error(`No such connection with name "${name}" exists`);
        }
        return connection;
    }
    create(options) {
        const { name = 'default' } = options;
        if (this.connections.has(name)) {
            throw new Error(`There is already an existing connection with name "${name}".`);
        }
        this.connections.set(name, new connection_1.Connection(options, this.clearByName.bind(this) // bind Connection manager ctx
        ));
        const createdConnection = this.connections.get(name);
        if (!createdConnection) {
            throw new Error(`New connection with name "${name}" was created but could not be found.`);
        }
        return createdConnection;
    }
    clear() {
        this.connections = new Map();
    }
    clearByName(name) {
        this.connections.delete(name);
    }
}
exports.ConnectionManager = ConnectionManager;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29ubmVjdGlvbi1tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvY29yZS9zcmMvY2xhc3Nlcy9jb25uZWN0aW9uL2Nvbm5lY3Rpb24tbWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSw2Q0FBd0M7QUFFeEMsTUFBYSxpQkFBaUI7SUFHNUI7UUFDRSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksR0FBRyxFQUFzQixDQUFDO0lBQ25ELENBQUM7SUFFRCxHQUFHLENBQUMsSUFBSSxHQUFHLFNBQVM7UUFDbEIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNmLE1BQU0sSUFBSSxLQUFLLENBQUMsaUNBQWlDLElBQUksVUFBVSxDQUFDLENBQUM7U0FDbEU7UUFDRCxPQUFPLFVBQVUsQ0FBQztJQUNwQixDQUFDO0lBRUQsTUFBTSxDQUFDLE9BQTBCO1FBQy9CLE1BQU0sRUFBQyxJQUFJLEdBQUcsU0FBUyxFQUFDLEdBQUcsT0FBTyxDQUFDO1FBQ25DLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDOUIsTUFBTSxJQUFJLEtBQUssQ0FDYixzREFBc0QsSUFBSSxJQUFJLENBQy9ELENBQUM7U0FDSDtRQUNELElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUNsQixJQUFJLEVBQ0osSUFBSSx1QkFBVSxDQUNaLE9BQU8sRUFDUCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyw4QkFBOEI7U0FDM0QsQ0FDRixDQUFDO1FBRUYsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyRCxJQUFJLENBQUMsaUJBQWlCLEVBQUU7WUFDdEIsTUFBTSxJQUFJLEtBQUssQ0FDYiw2QkFBNkIsSUFBSSx1Q0FBdUMsQ0FDekUsQ0FBQztTQUNIO1FBQ0QsT0FBTyxpQkFBaUIsQ0FBQztJQUMzQixDQUFDO0lBRUQsS0FBSztRQUNILElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxHQUFHLEVBQXNCLENBQUM7SUFDbkQsQ0FBQztJQUVELFdBQVcsQ0FBQyxJQUFZO1FBQ3RCLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hDLENBQUM7Q0FDRjtBQTlDRCw4Q0E4Q0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0Nvbm5lY3Rpb25PcHRpb25zfSBmcm9tICcuL2Nvbm5lY3Rpb24tb3B0aW9ucyc7XG5pbXBvcnQge0Nvbm5lY3Rpb259IGZyb20gJy4vY29ubmVjdGlvbic7XG5cbmV4cG9ydCBjbGFzcyBDb25uZWN0aW9uTWFuYWdlciB7XG4gIHByaXZhdGUgY29ubmVjdGlvbnM6IE1hcDxzdHJpbmcsIENvbm5lY3Rpb24+O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY29ubmVjdGlvbnMgPSBuZXcgTWFwPHN0cmluZywgQ29ubmVjdGlvbj4oKTtcbiAgfVxuXG4gIGdldChuYW1lID0gJ2RlZmF1bHQnKSB7XG4gICAgY29uc3QgY29ubmVjdGlvbiA9IHRoaXMuY29ubmVjdGlvbnMuZ2V0KG5hbWUpO1xuICAgIGlmICghY29ubmVjdGlvbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBzdWNoIGNvbm5lY3Rpb24gd2l0aCBuYW1lIFwiJHtuYW1lfVwiIGV4aXN0c2ApO1xuICAgIH1cbiAgICByZXR1cm4gY29ubmVjdGlvbjtcbiAgfVxuXG4gIGNyZWF0ZShvcHRpb25zOiBDb25uZWN0aW9uT3B0aW9ucykge1xuICAgIGNvbnN0IHtuYW1lID0gJ2RlZmF1bHQnfSA9IG9wdGlvbnM7XG4gICAgaWYgKHRoaXMuY29ubmVjdGlvbnMuaGFzKG5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBUaGVyZSBpcyBhbHJlYWR5IGFuIGV4aXN0aW5nIGNvbm5lY3Rpb24gd2l0aCBuYW1lIFwiJHtuYW1lfVwiLmBcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuY29ubmVjdGlvbnMuc2V0KFxuICAgICAgbmFtZSxcbiAgICAgIG5ldyBDb25uZWN0aW9uKFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0aGlzLmNsZWFyQnlOYW1lLmJpbmQodGhpcykgLy8gYmluZCBDb25uZWN0aW9uIG1hbmFnZXIgY3R4XG4gICAgICApXG4gICAgKTtcblxuICAgIGNvbnN0IGNyZWF0ZWRDb25uZWN0aW9uID0gdGhpcy5jb25uZWN0aW9ucy5nZXQobmFtZSk7XG4gICAgaWYgKCFjcmVhdGVkQ29ubmVjdGlvbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgTmV3IGNvbm5lY3Rpb24gd2l0aCBuYW1lIFwiJHtuYW1lfVwiIHdhcyBjcmVhdGVkIGJ1dCBjb3VsZCBub3QgYmUgZm91bmQuYFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGNyZWF0ZWRDb25uZWN0aW9uO1xuICB9XG5cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5jb25uZWN0aW9ucyA9IG5ldyBNYXA8c3RyaW5nLCBDb25uZWN0aW9uPigpO1xuICB9XG5cbiAgY2xlYXJCeU5hbWUobmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy5jb25uZWN0aW9ucy5kZWxldGUobmFtZSk7XG4gIH1cbn1cbiJdfQ==